// ═══════════════════════════════════════════════════════════════════════════
// news.js — Новостная лента (газета + слухи)
//
// Ответственность:
//   - Список цитат с условиями показа (tier-система)
//   - Выбор случайной подходящей цитаты по состоянию игрока
//   - НЕ содержит DOM-кода — только данные
//
// Для добавления новостей: добавь объект в HEADLINES ниже.
// Формат:
//   { text: string, minOre?: n, minGold?: n, adsLevel?: n, shopOpen?: bool, weight?: n }
// ═══════════════════════════════════════════════════════════════════════════

// ─── СПИСОК ЗАГОЛОВКОВ ────────────────────────────────────────────────────────
//
// Условия (все опциональные, AND-логика):
//   minOre     — суммарно руды в банке >= N
//   minGold    — золота >= N
//   maxGold    — золота <= N
//   maxOre     — руды в банке <= N  (для ранних новостей)
//   adsLevel   — уровень рекламы >= N
//   shopOpen   — магазин открыт
//   weight     — вес случайного выбора (по умолчанию 1)

export const HEADLINES = [
  // ─── НАЧАЛО (0 руды, магазин закрыт) ─────────────────────────────────────
  {
    text: "«В горах обнаружены новые пещеры с богатыми залежами руды. Местные жители советуют держаться подальше.»",
    maxOre: 5,
    weight: 3,
  },
  {
    text: "«Редакция ищет смельчаков для разведки старых шахт. Оплата — по договорённости.»",
    maxOre: 10,
    weight: 2,
  },
  {
    text: "«Говорят, позапрошлой ночью кто-то видел свет в заброшенных копях. Совпадение?»",
    maxOre: 20,
    weight: 2,
  },

  // ─── ПЕРВЫЕ УСПЕХИ (есть руда) ────────────────────────────────────────────
  {
    text: "«На рынке заметили незнакомца с увесистым мешком камней. Торговцы в недоумении.»",
    minOre: 5,
    maxOre: 30,
    weight: 2,
  },
  {
    text: "«Цены на кирки и лопаты неожиданно выросли. Эксперты теряются в догадках.»",
    minOre: 15,
    weight: 1,
  },
  {
    text: '«Местный кузнец жалуется: "Все хотят прочные сапоги. Для чего — не говорят".»',
    minOre: 20,
    weight: 1,
  },

  // ─── МАГАЗИН ОТКРЫТ ───────────────────────────────────────────────────────
  {
    text: "«В квартале у рынка открылась новая лавка. Торгует камнями. Публика озадачена.»",
    shopOpen: true,
    minOre: 1,
    weight: 3,
  },
  {
    text: '«Приезжие торговцы всё чаще наведываются в наш городок. По слухам, ищут "особый товар".»',
    shopOpen: true,
    minGold: 5,
    weight: 2,
  },
  {
    text: "«Замечено: у лавки с камнями постоянно толпится народ. Неужели это модно?»",
    shopOpen: true,
    minGold: 20,
    weight: 2,
  },

  // ─── РЕКЛАМА ──────────────────────────────────────────────────────────────
  {
    text: '«Весь город увешан листовками с предложением купить "высококачественную горную породу".»',
    adsLevel: 1,
    weight: 2,
  },
  {
    text: "«На площади появился глашатай, расхваливающий достоинства местной руды. Толпа растёт.»",
    adsLevel: 2,
    weight: 2,
  },
  {
    text: '«Купцы из дальних земель наслышаны о "легендарном шахтёре". Слухи преувеличены.»',
    adsLevel: 3,
    weight: 2,
  },

  // ─── БОГАТСТВО ────────────────────────────────────────────────────────────
  {
    text: "«Местный ростовщик заявил, что впервые за годы чувствует конкуренцию. Имён не называет.»",
    minGold: 50,
    weight: 1,
  },
  {
    text: "«Жители деревни всё чаще рассчитываются камнями вместо монет. Экономисты обеспокоены.»",
    minGold: 100,
    minOre: 50,
    weight: 1,
  },
  {
    text: "«Городской советник предложил ввести налог на торговлю рудой. Законопроект провален.»",
    minGold: 150,
    weight: 1,
  },
  {
    text: "«По данным переписи, треть населения работает в горнодобывающей отрасли. Все — на одного работодателя.»",
    minGold: 300,
    minOre: 100,
    weight: 1,
  },

  // ─── АБСУРДНО-СМЕШНЫЕ (поздняя игра) ────────────────────────────────────
  {
    text: "«Герольды объявили о введении новой валюты. Курс: 3 монеты за 1 руду. Инициатор неизвестен.»",
    minGold: 200,
    minOre: 80,
    weight: 1,
  },
  {
    text: "«Вся экономика близлежащей деревни держится на руде из одной шахты. Мэр не комментирует.»",
    minGold: 400,
    weight: 1,
  },
  {
    text: '«Академия наук открыла кафедру "Прикладного шахтоведения". Финансирование анонимное.»',
    minGold: 500,
    adsLevel: 2,
    weight: 1,
  },
  {
    text: "«Папа Римский, говорят, интересовался ценой на руду. Источник не подтверждён.»",
    minGold: 800,
    weight: 1,
  },
  {
    text: "«Ходят слухи, что некий шахтёр в одиночку добывает больше руды, чем целое королевство. Это, конечно, преувеличение.»",
    minOre: 200,
    minGold: 600,
    weight: 1,
  },

  // ─── ЭКОНОМИКА И ИМПОРТОЗАМЕЩЕНИЕ (2025-2026) ───────────────────────────
  {
    text: "«Минфин анонсировал изъятие сверхдоходов шахтеров. Спойлер: сверхдоходов нет»",
    shopOpen: true,
    maxOre: 30,
    weight: 2,
  },
  {
    text: "«Курс руды упал ниже плинтуса. Следующий апгрейд выглядит как дальняя мечта»",
    maxOre: 20,
    weight: 2,
  },
  {
    text: "«Китайский ширпотреб vs Местная руда: битва, которой никто не ждал»",
    shopOpen: true,
    weight: 1,
  },
  {
    text: "«По слухам, вместо рекламы в шахте теперь вешают портреты директора. Посетители пугаются»",
    shopOpen: true,
    adsLevel: 1,
    weight: 1,
  },
  {
    text: "«Себестоимость кирки выросла на 40%. Поздравляю, теперь ты работаешь в минус»",
    maxGold: 20,
    weight: 2,
  },

  // ─── ВЕСТНИК: ЭКОНОМИКА ───────────────────────────────────────────────────
  {
    text: "«Срочные новости: местный шахтер признан банкротом. Остатки руды ушли на погашение долгов за кислород»",
    maxGold: 0,
    weight: 3,
  },
  {
    text: "«Добыча руды бьет рекорды! Эксперты связывают это с тотальным отсутствием личной жизни у шахтера»",
    minOre: 150,
    weight: 2,
  },
  {
    text: "«Кризис в шахтерской отрасли. Молодежь не хочет идти в забой, предпочитая доставлять еду и слушать подкасты про саморазвитие»",
    maxOre: 18,
    weight: 2,
  },

  // ─── ВЕСТНИК: РЕКЛАМА И ПОСЕТИТЕЛИ ────────────────────────────────────────
  {
    text: "«Маркетинговая кампания провалилась. Пост на АВИТО не сработал.",
    shopOpen: true,
    maxGold: 5,
    weight: 2,
  },
  {
    text: "«Свершилось! Кто-то купил руду. Видимо, коллекционер редких минералов или просто человек с очень странными хобби»",
    shopOpen: true,
    minGold: 1,
    weight: 2,
  },
  {
    text: "«Вы вложились в рекламу. Теперь о вашей шахте узнают двое зевак проходящих мимо.",
    adsLevel: 1,
    shopOpen: true,
    weight: 2,
  },

  // ─── ВЕСТНИК: ПРОГРЕСС ─────────────────────────────────────────────────────
  {
    text: "«Магазин открыт! Теперь здесь официально торгуют рудой. Выглядит как сарай, но гордость переполняет»",
    shopOpen: true,
    weight: 2,
  },
  {
    text: "«Стаж шахтера превысил 10 часов. Рекомендуем пройти диспансеризацию, но мы знаем, что вы не пойдете»",
    minOre: 120,
    shopOpen: true,
    weight: 1,
  },

  // ─── ВЕСТНИК: ФОН ──────────────────────────────────────────────────────────
  {
    text: "«В этой шахте темно, сыро и вообще непонятно, зачем я здесь. Но назад дороги нет — там социализация и ответственность»",
    weight: 1,
  },
  {
    text: "«Опрос показал: 90% шахтеров недовольны условиями труда. Остальные 10% — это призраки, которым уже все равно»",
    weight: 1,
  },
  {
    text: "«Новая традиция: перед спуском в шахту шахтеры смотрят шортсы на VK Видео, чтобы морально подготовиться к вечности»",
    weight: 1,
  },
  {
    text: "«Кстати, в соседней шахте руды больше. Но там повышенный риск обвала. Как говорится, или вкусно, или много, или вообще никак»",
    weight: 1,
  },

  // ─── СТАТИСТИКА И РЕКОРДЫ ─────────────────────────────────────────────────
  {
    text: "«Новый рекорд добычи! Местный шахтер накопил столько руды, что может позволить себе купить квартиру. В Майнкрафте.»",
    minOre: 300,
    weight: 1,
  },
  {
    text: "«Антирекорд: шахтер умер в 50-й раз. Профсоюз готовит благодарственное письмо за вклад в статистику.»",
    maxGold: 10,
    weight: 1,
  },
  {
    text: "«Шахтер не выходит из игры 6 часов. Родные бьют тревогу. Соседи бьют по батареям. Всем всё равно.»",
    minOre: 120,
    weight: 1,
  },

  // ─── МАГАЗИН И ЭКОНОМИКА (ДОП) ────────────────────────────────────────────
  {
    text: "«Золота навалом! Пора покупать яхту. Или хотя бы новую каску. Выбираем яхту, каска не обязательна.»",
    minGold: 300,
    weight: 1,
  },
  {
    text: "«Шахтер приобрел улучшение. Эксперты считают это пустой тратой ресурсов. Но экспертам никто не платит, так что молчим.»",
    shopOpen: true,
    minGold: 30,
    weight: 1,
  },
  {
    text: "«Внимание! В шахте завелись воришки. Пропажа руды. Подозреваются кроты с высшим образованием.»",
    maxOre: 30,
    shopOpen: true,
    weight: 1,
  },

  // ─── СЛУХИ И СПЛЕТНИ ──────────────────────────────────────────────────────
  {
    text: '«Говорят, скоро запустят раздел "Шахтерский мерч". Там будут продавать подтяжки для рабочих штанов и модные фонари на каску.»',
    weight: 1,
  },
  {
    text: "«Слух дня: Telegram скоро заблокируют окончательно. Шахтеры готовятся к массовой миграции в Макс.»",
    weight: 1,
  },
  {
    text: "«YouTube замедлили. Теперь шахтеры смотрят видеоуроки по выживанию в шахте в режиме слайд-шоу.»",
    weight: 1,
  },
  {
    text: "«ChatGPT посоветовал не ходить в шахту. Шахтер пошел. ChatGPT в шоке. Шахтер тоже, когда умер.»",
    weight: 1,
  },

  // ─── СЕЗОННОЕ ──────────────────────────────────────────────────────────────
  {
    text: "«С наступающим! Желаем вам в новом году меньше обвалов и больше руды. И здоровья. Много здоровья.»",
    weight: 1,
  },
  {
    text: "«На улице лето, жара, шашлыки. А ты в шахте. Выбор очевиден. Шашлыки подождут, руда не ждет.»",
    weight: 1,
  },
  {
    text: "«Понедельник — день тяжелый. Особенно если ты в шахте с утра и уже умер дважды.»",
    weight: 1,
  },

  // ─── ОСОБЫЕ СОБЫТИЯ ───────────────────────────────────────────────────────
  {
    text: "«Поздравляю! Теперь у тебя есть магазин. Выглядит как подсобка в подвале, но гордость переполняет.»",
    shopOpen: true,
    minOre: 40,
    weight: 1,
  },
  {
    text: "«Тонна руды! Если бы это было золото, ты бы уже купил остров. Но это руда, так что снова в бой.»",
    minOre: 1000,
    weight: 1,
  },
  {
    text: "«Первая кровь! Точнее, первый обвал. В этой игре умирать — часть билда.»",
    maxOre: 25,
    weight: 1,
  },
  {
    text: "«Магазин пустует уже 24 часа. Покупатели игнорируют твою руду. Может, пора пересмотреть ценник?»",
    shopOpen: true,
    maxGold: 15,
    weight: 1,
  },

  // ─── ВЕСТНИК: ЭКОНОМИКА И РУДА (ДОП) ──────────────────────────────────────
  {
    text: "«Добыча руды выросла на 500%! Шахтер теперь может позволить себе редкую роскошь — отдых длиной в 10 секунд.»",
    minOre: 250,
    weight: 1,
  },
  {
    text: "«Банк руды ломится от запасов. Геологи предполагают, что шахтер просто забыл, зачем он вообще это копает.»",
    minOre: 220,
    weight: 1,
  },
  {
    text: '«Состояние шахтера оценили эксперты. Вердикт: "Богат, но счастлив ли?" Спойлер: нет.»',
    minOre: 180,
    weight: 1,
  },
  {
    text: "«Аналитики предупреждают: переизбыток руды на складе ведет к покупке бесполезных апгрейдов.»",
    minOre: 240,
    weight: 1,
  },
  {
    text: '«Руды столько, что можно открывать свой банк. Название: "Шахта и партнеры". Партнеров нет, но звучит.»',
    minOre: 260,
    weight: 1,
  },
  {
    text: "«Местный шахтер официально признан олигархом. Олигархом с одной лопатой и грыжей.»",
    minOre: 300,
    weight: 1,
  },
  {
    text: "«Банк руды пуст. Шахтер признан банкротом. Кредиторы требуют вернуть лопату.»",
    maxOre: 5,
    weight: 2,
  },
  {
    text: "«Кризис добычи: руда кончилась быстрее, чем терпение.»",
    maxOre: 12,
    weight: 2,
  },
  {
    text: '«Экономист: "Если так пойдет дальше, шахтеру придется продать каску". Шахтер: "У меня нет каски".»',
    maxOre: 10,
    weight: 1,
  },
  {
    text: "«Дефицит руды достиг критических значений. Шахтер рассматривает вариант копать в другую сторону.»",
    maxOre: 15,
    weight: 1,
  },
  {
    text: "«Руды нет вообще. Шахтер смотрит в пустоту. Пустота смотрит в ответ.»",
    maxOre: 3,
    weight: 2,
  },
  {
    text: "«Аналитика: чтобы накопить на апгрейд, шахтеру нужно работать еще 300 лет.»",
    maxOre: 20,
    weight: 1,
  },
  {
    text: "«Свежая руда поступила в банк. Шахтер чувствует прилив дофамина. Ненадолго.»",
    minOre: 20,
    maxOre: 120,
    weight: 1,
  },
  {
    text: "«Добыча успешна! Шахтер пополнил запас. До пенсии осталось всего немного вечности.»",
    minOre: 15,
    weight: 1,
  },
  {
    text: "«Очередная партия руды. Шахтер верит, что это последняя. Шахтер наивен.»",
    minOre: 25,
    weight: 1,
  },
  {
    text: "«Руда найдена! Местные СМИ называют это чудом. Местные СМИ — это соседский попугай.»",
    minOre: 10,
    weight: 1,
  },

  // ─── ВЕСТНИК: ЗДОРОВЬЕ/СМЕРТЬ ─────────────────────────────────────────────
  {
    text: "«HP критическое. Еще один удар — и всё. Но шахтер продолжает копать.»",
    maxOre: 40,
    weight: 1,
  },
  {
    text: "«Травматизм на производстве зашкаливает. Шахтер получил сотрясение, ушиб и моральную травму.»",
    weight: 1,
  },
  {
    text: "«Шахтер выглядит так, будто его неделю кормили обещаниями. Бледный, злой и готовится к смерти.»",
    weight: 1,
  },
  {
    text: "«Шахтер погиб. Местные жители почтили минутой молчания. Местные жители — мышь и таракан.»",
    weight: 1,
  },
  {
    text: '«Смерть в шахте. Причина: "наступил не туда". Следователи уточнили: "не туда" — это вся шахта.»',
    weight: 1,
  },
  {
    text: "«Летальный исход зафиксирован. Реинкарнация в цифровую эпоху называется респаун.»",
    weight: 1,
  },
  {
    text: "«Чудо! Шахтер выжил. Вопреки статистике и желанию страховой компании.»",
    weight: 1,
  },
  {
    text: "«Выживание засчитано. Ложное чувство бессмертия выдано.»",
    weight: 1,
  },

  // ─── ВЕСТНИК: МАГАЗИН И ПОСЕТИТЕЛИ (ДОП) ─────────────────────────────────
  {
    text: '«Магазин "Шахтерский уют" открыл двери. Внутри: руда, пыль и чувство безысходности.»',
    shopOpen: true,
    weight: 1,
  },
  {
    text: "«Торговая точка запущена. Ассортимент: руда оптом и в розницу.»",
    shopOpen: true,
    weight: 1,
  },
  {
    text: "«Открытие сезона распродаж! Купи руду сейчас — получи бесплатный обвал в подарок.»",
    shopOpen: true,
    weight: 1,
  },
  {
    text: "«Магазин работает круглосуточно. Закрывать его все равно некому.»",
    shopOpen: true,
    weight: 1,
  },
  {
    text: "«Внимание! В магазин зашел посетитель. Событие войдет в историю.»",
    shopOpen: true,
    minGold: 1,
    weight: 1,
  },
  {
    text: "«Сделка совершена! Руда обменяна на золото. Экономика работает. Пока.»",
    shopOpen: true,
    minGold: 10,
    weight: 1,
  },
  {
    text: "«Продажа! Шахтер получил золото. Теперь можно купить... еще одну лопату.»",
    shopOpen: true,
    minGold: 15,
    weight: 1,
  },
  {
    text: "«Магазин пуст уже 2 часа. Шахтер разговаривает с рудой. Руда — идеальный собеседник.»",
    shopOpen: true,
    maxGold: 10,
    weight: 1,
  },
  {
    text: "«Ноль посетителей. Шахтер начинает подозревать, что руда никому не нужна.»",
    shopOpen: true,
    maxGold: 5,
    weight: 1,
  },
  {
    text: "«Маркетинговая кампания провалилась. Никто не хочет покупать руду. Даже кроты.»",
    shopOpen: true,
    maxGold: 5,
    weight: 1,
  },
  {
    text: "«Уровень рекламы повышен! Теперь о магазине знают аж 10 человек.»",
    shopOpen: true,
    adsLevel: 1,
    weight: 1,
  },
  {
    text: "«Реклама сработала! Поток клиентов увеличился вдвое. Был 0, стал... подождите.»",
    shopOpen: true,
    adsLevel: 2,
    weight: 1,
  },

  // ─── ВЕСТНИК: ПРОГРЕСС И АПГРЕЙДЫ (ДОП) ──────────────────────────────────
  {
    text: "«Шахтер приобрел улучшение. Теперь копает быстрее и ругается тише.»",
    minGold: 20,
    shopOpen: true,
    weight: 1,
  },
  {
    text: '«Апгрейд активирован! Эффективность выросла до "чуть менее никчемный".»',
    minGold: 35,
    shopOpen: true,
    weight: 1,
  },
  {
    text: "«Долгая сессия: шахтер в системе так долго, что слился с лопатой в единый организм.»",
    minOre: 180,
    weight: 1,
  },
  {
    text: "«Личный рекорд побит! Мир никогда не будет прежним. Шахтер тоже.»",
    minOre: 220,
    weight: 1,
  },

  // ─── ВЕСТНИК: МЕМЫ/СЕТИ ────────────────────────────────────────────────────
  {
    text: "«VK запустил раздел для шахтеров. Теперь можно ставить лайки в `Подслушано Шахтерск`.»",
    weight: 1,
  },
  {
    text: "«Telegram снова работает со сбоями. Шахтер не заметил разницы — шахта не парковка, там не ловит.»",
    weight: 1,
  },
  {
    text: '«YouTube замедлили до состояния "успеешь состариться".»',
    weight: 1,
  },
  {
    text: "«Нейросеть сгенерировала идеальную шахту: много руды, нет обвалов. Шахтеру скучно.»",
    weight: 1,
  },

  // ─── ВЕСТНИК: АТМОСФЕРА ───────────────────────────────────────────────────
  {
    text: "«В шахте сегодня темно, сыро и холодно. Прогноз на завтра: темно, сыро и холодно.»",
    weight: 1,
  },
  {
    text: "«Атмосферное давление низкое. Давление на психику — рекордное.»",
    weight: 1,
  },
  {
    text: '«Шахтер задумался: "Зачем я здесь?". Ответ не найден. Копает дальше.»',
    weight: 1,
  },
  {
    text: "«В шахте замечена крыса. Крыса выглядит уверенно. Это тревожно.»",
    weight: 1,
  },
  {
    text: "«Соседний шахтер накопил больше руды. Началась тихая конкуренция с громкими последствиями.»",
    minOre: 60,
    weight: 1,
  },
];

// ─── ВЫБОР ЦИТАТЫ ─────────────────────────────────────────────────────────────

/**
 * Возвращает случайный заголовок, подходящий по условиям.
 * @param {{ ore: number, gold: number, adsLevel: number, shopOpen: boolean }} ctx
 */
export function pickHeadline(ctx) {
  const { ore, gold, adsLevel, shopOpen } = ctx;

  const matching = HEADLINES.filter((h) => {
    if (h.minOre !== undefined && ore < h.minOre) return false;
    if (h.maxOre !== undefined && ore > h.maxOre) return false;
    if (h.minGold !== undefined && gold < h.minGold) return false;
    if (h.maxGold !== undefined && gold > h.maxGold) return false;
    if (h.adsLevel !== undefined && adsLevel < h.adsLevel) return false;
    if (h.shopOpen !== undefined && shopOpen !== h.shopOpen) return false;
    return true;
  });

  if (matching.length === 0) return HEADLINES[0].text;

  // Взвешенный случайный выбор
  const totalWeight = matching.reduce((s, h) => s + (h.weight ?? 1), 0);
  let roll = Math.random() * totalWeight;
  for (const h of matching) {
    roll -= h.weight ?? 1;
    if (roll <= 0) return h.text;
  }
  return matching[matching.length - 1].text;
}
