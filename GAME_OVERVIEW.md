# DELVE: Краткое описание текущей версии

## 1. Суть игры
`DELVE` — однопользовательская браузерная игра (Vite + Vanilla JS), где основной геймплей сочетает:
- тактическую вылазку в формате "сапера" (поиск безопасных клеток, риск обвала),
- мета-прогрессию (банк руды, разблокировки),
- idle-экономику (магазин, посетители, продажа руды в фоне).

Игровая фантазия: шахтер уходит в пещеру за рудой, рискует здоровьем, копит ресурс и строит добывающий бизнес.

---

## 2. Основной цикл
1. Игрок выбирает сложность вылазки.
2. В пещере открывает клетки:
- безопасные клетки раскрываются,
- нестабильные наносят урон и могут вызвать обвал,
- обнаруженная руда собирается кликом.
3. Собранная руда идет в общий банк.
4. Банк тратится на апгрейды (в т.ч. открытие магазина).
5. Магазин в фоне продает руду посетителям за золото.

---

## 3. Вылазка (сапер-слой)
### Поле и клетки
- Размер сетки: `15x15`.
- Типы клеток:
  - `empty` (пустая),
  - `ore` (рудная),
  - `unstable` (опасная/нестабильная).

### Состояния клеток
- `hidden` (скрыта),
- `open` (открыта),
- `flagged` (помечена),
- `revealed` (руда обнаружена и кликабельна).

### Правила
- ЛКМ открывает клетку.
- ПКМ ставит/снимает метку.
- Удар по `unstable`:
  - `-1 HP`,
  - запускает обвал части открытых клеток.
- Руда добывается только если она обнаружена (`revealed`) и кликнута.
- При бездействии запускается отдельный idle-обвал.

### Завершение вылазки
- `death` — HP = 0.
- `clear` — все не-опасные клетки открыты.
- `escape` — досрочный выход (теряется часть руды по сложности).

---

## 4. Сложности
Три режима: `easy`, `normal`, `hard`.

Отличаются:
- шансом опасных клеток,
- шансом руды,
- стартовым HP,
- масштабом обвала от удара,
- временем до idle-обвала и его силой,
- штрафом руды при досрочном выходе.

Текущая логика: на легкой сложности руды меньше, чем на высокой (риск/награда растут вместе).

---

## 5. Мета-прогрессия
- Весь добытый ресурс хранится в `БАНКЕ РУДЫ`.
- Прогресс сохраняется в `localStorage`.
- Доступен полный сброс прогресса.
- После сброса создается новый персонаж:
  - ввод имени,
  - выбор пола (иконка мужчины/женщины).

---

## 6. Магазин (idle-слой)
### Разблокировка
- Апгрейд `Магазин` покупается за руду в главном меню.

### Как работает
- Пока магазин открыт, в фоне раз в секунду проверяется шанс посетителя.
- Посетитель покупает часть руды из банка за золото.
- Шанс посетителей повышается рекламными апгрейдами.

### Реклама
- Несколько уровней рекламы (cookie-clicker-подобная подача карточек).
- Каждый уровень увеличивает множитель потока покупателей.

### Фоновый режим
- Магазин работает даже когда игрок:
  - в вылазке,
  - в главном меню,
  - на экране результатов.
- Продажи отображаются всплывающими уведомлениями (toast) в углу.

---

## 7. Вестник (новостная лента)
- Вверху главного экрана есть лента "вестника".
- Заголовки выбираются по условиям из данных игрока:
  - руды,
  - золота,
  - уровня рекламы,
  - состояния магазина.
- Реплики хранятся отдельно и легко расширяются.

---

## 8. Персонаж и атмосфера
### Игрок на поле
- Отображается иконка шахтера, двигающаяся по клеткам.
- Есть анимации:
  - копания,
  - подбора,
  - поражения.

### Комментатор
- Слева отображается аватар шахтера и текстовые комментарии событий.
- Имя в формате `Шахтер <ИмяИгрока>`.
- Реплики вынесены в отдельный модуль.

---

## 9. Визуальная логика фонов
- `back1` — фон главного экрана по умолчанию.
- `back2` — фон после разблокировки магазина.

Оба фона лежат в: `src/backgrounds/`.

---

## 10. Хранение данных (localStorage)
Ключевые данные:
- банк руды,
- флаги купленных апгрейдов,
- состояние магазина,
- золото,
- уровень рекламы,
- имя и пол персонажа.

---

## 11. Текущая структура кода
- `src/main.js` — сборка экранов, общий UI, переходы, игровая сцена.
- `src/game.js` — логика поля, клетки, обвалы, проверка победы/поражения.
- `src/render.js` — отрисовка сетки и визуальные обновления клеток.
- `src/shop.js` — чистая логика магазина/idle-экономики.
- `src/shop-ui.js` — UI магазина и отображение shop-статистики.
- `src/news.js` — набор заголовков и фильтрация по контексту игрока.
- `src/news-ticker.js` — ротация/рендер вестника.
- `src/narrator-lines.js` — набор реплик комментатора.
- `src/style.css` — глобальные стили экранов и анимации.

---

## 12. Технически
- Стек: `Vite`, `Vanilla JS`, `CSS`, `localStorage`.
- Проект собирается командой:
```bash
npm run build
```
